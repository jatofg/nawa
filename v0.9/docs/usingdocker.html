<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NAWA: Using Docker</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NAWA<span id="projectnumber">&#160;0.9</span>
   </div>
   <div id="projectbrief">Web Application Framework for C++</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('usingdocker.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Using Docker </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_docs_docker"></a></p>
<p ><b>Please note that the Docker images are currently mostly untested and only used as a CI. They are no longer available from the GitHub package repository.</b></p>
<p ><b>This manual page is no longer actively maintained.</b></p>
<p ><strike>Docker images are built automatically by GitHub and are available <a href="https://github.com/jatofg/nawa/packages">here</a>.</strike></p>
<p ><strike>To install them, you need a GitHub account and access token (click "Learn more" on the package page for more information). After logging in with docker, use the command on the package page to pull the image.</strike></p>
<p >To try out NAWA with the Hello World example app, you can start a container like this:</p>
<p ><code>docker run -p 127.0.0.1:8000:8000 docker.pkg.github.com/jatofg/nawa/nawa</code></p>
<p >The IP address after "-p" specifies the interface for Docker to publish the external port (127.0.0.1 means that Docker, and therefore NAWA, will only accept FastCGI connections from localhost). You should always set the interface IP address, as you don't want that the whole world is able to connect to your NAWA app via FastCGI &ndash; only the web server should be able to do that. The port between the colons is the external listening port on your machine &ndash; connect to this port via FastCGI to access the app (you can choose any port). The third element is the internal port in the container, as used by NAWA. This port must be 8000, unless you change it in the config file.</p>
<p >Next, set up your web server to connect to NAWA via FastCGI on the external listening port, e.g., 8000. This works exactly like without Docker. To learn how to do that, have a look to the <a class="el" href="gettingstarted.html">Getting Started</a> tutorial.</p>
<p >Then, you should be able to admire the "Hello World!" message in your web browser.</p>
<h1>Using your own app</h1>
<p >In the <a class="el" href="gettingstarted.html">Getting Started</a> tutorial, you can learn how to write your first own app with NAWA.</p>
<p >However, there are certain options in the config file that should be set in a certain way so they'll work with the Docker image, so you should copy the <code>[fastcgi]</code> and <code>[privileges]</code> section from the file <code>docker/nawa/config.ini</code> (in the source code/GitHub repo) or from here:</p>
<div class="fragment"><div class="line">[fastcgi]</div>
<div class="line">; Docker has to communicate with the host via TCP</div>
<div class="line">mode = tcp</div>
<div class="line">; Listen to all interfaces, so the port can be accessed by the outer world</div>
<div class="line">listen = all</div>
<div class="line">; Internal port to use with the -p option of Docker</div>
<div class="line">port = 8000</div>
<div class="line">; Irrelevant options for Docker</div>
<div class="line">path = /nawa/nawa.sock</div>
<div class="line">permissions =</div>
<div class="line">owner = nawa</div>
<div class="line">group = nawa</div>
<div class="line">; SO_REUSEADDR not necessary for Docker</div>
<div class="line">reuseaddr = off</div>
<div class="line"> </div>
<div class="line">[privileges]</div>
<div class="line">; user NAWA should run as (can be either nawa or root in Docker)</div>
<div class="line">user = nawa</div>
<div class="line">; group NAWA should run as (can be either nawa or root in Docker)</div>
<div class="line">group = nawa</div>
</div><!-- fragment --><p >Also, please note that the your directory containing the app has to be addressed as <code>/nawa</code>, so the application section might be:</p>
<div class="fragment"><div class="line">[application]</div>
<div class="line">; Path to application to load</div>
<div class="line">path = /nawa/myapp.so</div>
</div><!-- fragment --><p >To use your app in the NAWA docker container, just create a directory with the config file (which must be named "config.ini" for use with Docker), your actual app (the <code>.so</code> file), and all assets your app needs. Then, mount this directory as <code>/nawa</code> in your container:</p>
<p ><code>docker run -p 127.0.0.1:8000:8000 -v /path/to/my/nawaApp:/nawa docker.pkg.github.com/jatofg/nawa/nawa</code></p>
<h1>Building the Docker image</h1>
<p >If your app uses external libraries, you might need to modify the Dockerfile and add all libraries you need for your app to work to the <code>apt-get install</code> section.</p>
<p >You could also modify the image contents to include your actual app instead of the "Hello World" example.</p>
<p >Then, you can build the image simply by switching to the top level directory of the NAWA sources and running (change the tag as you like):</p>
<p ><code>docker build -t mynawaimage .</code> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
