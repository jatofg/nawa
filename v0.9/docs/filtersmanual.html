<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NAWA: Filters and Sending Files</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NAWA<span id="projectnumber">&#160;0.9</span>
   </div>
   <div id="projectbrief">Web Application Framework for C++</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('filtersmanual.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Filters and Sending Files </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_docs_filters"></a></p>
<p >Usually, a website also contains static elements such as images, templates, stylesheets, and so on. The ForwardFilter feature of NAWA can deal with this (and send static elements automatically) and keep this out of your main application logic (in <code>handleRequest</code>). It takes care of content types and cooperates with the browser for optimal caching of static resources.</p>
<p >Additionally, BlockFilters can block access to certain paths and AuthFilters authenticate access.</p>
<p >Filters are defined in the <code>init</code> function of your app.</p>
<h1>Enable filtering</h1>
<p >In your <code>int <a class="el" href="sessiontest_8cpp.html#a613b569b56b1775da81612652d0dd0f7">init(AppInit &amp;appInit)</a></code> function, you can use the <code><a class="el" href="classnawa_1_1AppInit.html">nawa::AppInit</a></code> object to enable filtering and to define filters.</p>
<p >Enable static filtering by setting:</p>
<div class="fragment"><div class="line">appInit.accessFilters().filtersEnabled(<span class="keyword">true</span>);</div>
</div><!-- fragment --><h1>Filter conditions</h1>
<p >There are three criteria that can be used for filtering. A filter matches if and only if <b>all</b> of the defined conditions match. A filter without any conditions matches all requests. You can alter this behavior by inverting the filter (see the end of this section).</p>
<ul>
<li>Request path: Only files below one of the given paths match.</li>
<li>File extension: Only files with one of the given file extensions match.</li>
<li>Regex: Only URIs matched by a regular expression match.</li>
</ul>
<p >As an example, we use a <code>ForwardFilter</code>, but <code>BlockFilter</code>s and <code>AuthFilter</code>s work equally.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classnawa_1_1ForwardFilter.html">nawa::ForwardFilter</a> myFilter;</div>
<div class="ttc" id="aclassnawa_1_1ForwardFilter_html"><div class="ttname"><a href="classnawa_1_1ForwardFilter.html">nawa::ForwardFilter</a></div><div class="ttdef"><b>Definition:</b> <a href="ForwardFilter_8h_source.html#l00034">ForwardFilter.h:34</a></div></div>
</div><!-- fragment --><h2>Request path condition</h2>
<p >To apply a request path condition, provide a list (vector) of paths. Paths in NAWA are represented by vectors of strings, for example, the path <code>/static/images</code> would be represented by the vector <code>{"static", "images"}</code>. All files below a given path are matched, in our example, a file <code>/static/images/dir1/dir2/file.jpeg</code> would match. In the following example, the paths <code>/static/images</code> and <code>/static2/images</code> would be matched:</p>
<div class="fragment"><div class="line">myFilter.<a class="code hl_function" href="classnawa_1_1AccessFilter.html#acfec1fb9ad929cee56d78fe058c3602e">pathFilter</a>({{<span class="stringliteral">&quot;static&quot;</span>, <span class="stringliteral">&quot;images&quot;</span>}, {<span class="stringliteral">&quot;static2&quot;</span>, <span class="stringliteral">&quot;images&quot;</span>}});</div>
<div class="ttc" id="aclassnawa_1_1AccessFilter_html_acfec1fb9ad929cee56d78fe058c3602e"><div class="ttname"><a href="classnawa_1_1AccessFilter.html#acfec1fb9ad929cee56d78fe058c3602e">nawa::AccessFilter::pathFilter</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; std::string &gt; &gt; &amp; pathFilter() noexcept</div></div>
</div><!-- fragment --><p >If you want to match files outside of the given paths instead, you can invert the path filter condition:</p>
<div class="fragment"><div class="line">myFilter.<a class="code hl_function" href="classnawa_1_1AccessFilter.html#a556f3941613ed93c4f3d1c209555d174">invertPathFilter</a>(<span class="keyword">true</span>);</div>
<div class="ttc" id="aclassnawa_1_1AccessFilter_html_a556f3941613ed93c4f3d1c209555d174"><div class="ttname"><a href="classnawa_1_1AccessFilter.html#a556f3941613ed93c4f3d1c209555d174">nawa::AccessFilter::invertPathFilter</a></div><div class="ttdeci">bool &amp; invertPathFilter() noexcept</div></div>
</div><!-- fragment --><h2>File extension condition</h2>
<p >With an extension filter, you could limit the matched extensions to a set of common image formats, for example:</p>
<div class="fragment"><div class="line">myFilter.<a class="code hl_function" href="classnawa_1_1AccessFilter.html#a7027ed78938b1b563b7f3608a3858929">extensionFilter</a>({<span class="stringliteral">&quot;jpeg&quot;</span>, <span class="stringliteral">&quot;jpg&quot;</span>, <span class="stringliteral">&quot;png&quot;</span>, <span class="stringliteral">&quot;gif&quot;</span>, <span class="stringliteral">&quot;svg&quot;</span>});</div>
<div class="ttc" id="aclassnawa_1_1AccessFilter_html_a7027ed78938b1b563b7f3608a3858929"><div class="ttname"><a href="classnawa_1_1AccessFilter.html#a7027ed78938b1b563b7f3608a3858929">nawa::AccessFilter::extensionFilter</a></div><div class="ttdeci">std::vector&lt; std::string &gt; &amp; extensionFilter() noexcept</div></div>
</div><!-- fragment --><p >You can also invert the extension filter to match only files with other extensions:</p>
<div class="fragment"><div class="line">myFilter.<a class="code hl_function" href="classnawa_1_1AccessFilter.html#ad72c7233af6ff8ac90b2f4c840993d90">invertExtensionFilter</a>(<span class="keyword">true</span>);</div>
<div class="ttc" id="aclassnawa_1_1AccessFilter_html_ad72c7233af6ff8ac90b2f4c840993d90"><div class="ttname"><a href="classnawa_1_1AccessFilter.html#ad72c7233af6ff8ac90b2f4c840993d90">nawa::AccessFilter::invertExtensionFilter</a></div><div class="ttdeci">bool &amp; invertExtensionFilter() noexcept</div></div>
</div><!-- fragment --><h2>Using regular expressions</h2>
<p >To filter basing on a regular expression, you have to enable the regex filter explicitly, and then assign a regular expression:</p>
<div class="fragment"><div class="line">myFilter.<a class="code hl_function" href="classnawa_1_1AccessFilter.html#ac16263c9788d4026eb9c032f847fdcce">regexFilterEnabled</a>(<span class="keyword">true</span>);</div>
<div class="line">myFilter.<a class="code hl_function" href="classnawa_1_1AccessFilter.html#a74c3790d0c01f389c31fd76292b07cef">regexFilter</a>().assign(R<span class="stringliteral">&quot;(/test(/images)?(/[A-Za-z0-9_\-]*\.?[A-Za-z]{2,4})?)&quot;);</span></div>
<div class="ttc" id="aclassnawa_1_1AccessFilter_html_a74c3790d0c01f389c31fd76292b07cef"><div class="ttname"><a href="classnawa_1_1AccessFilter.html#a74c3790d0c01f389c31fd76292b07cef">nawa::AccessFilter::regexFilter</a></div><div class="ttdeci">std::regex &amp; regexFilter() noexcept</div></div>
<div class="ttc" id="aclassnawa_1_1AccessFilter_html_ac16263c9788d4026eb9c032f847fdcce"><div class="ttname"><a href="classnawa_1_1AccessFilter.html#ac16263c9788d4026eb9c032f847fdcce">nawa::AccessFilter::regexFilterEnabled</a></div><div class="ttdeci">bool &amp; regexFilterEnabled() noexcept</div></div>
</div><!-- fragment --><p >The above example would match everything that is not in <code>/test</code>, <code>/test/images</code>, and some more things. Please note that regex filters are expensive (in CPU cycles) and create a lot of overhead on every request. Use them only if your goal cannot be achieved without them.</p>
<p >It is not possible to invert the regex condition, as this can be achieved by modifying the regular expression.</p>
<h2>Inverting a filter</h2>
<p >You can invert your whole filter, so that your filter matches when <b>none</b> of your conditions match. An inverted filter without conditions matches no requests.</p>
<div class="fragment"><div class="line">myFilter.<a class="code hl_function" href="classnawa_1_1AccessFilter.html#aa273a92f2164278fae73ca549a71ff7c">invert</a>(<span class="keyword">true</span>);</div>
<div class="ttc" id="aclassnawa_1_1AccessFilter_html_aa273a92f2164278fae73ca549a71ff7c"><div class="ttname"><a href="classnawa_1_1AccessFilter.html#aa273a92f2164278fae73ca549a71ff7c">nawa::AccessFilter::invert</a></div><div class="ttdeci">bool &amp; invert() noexcept</div></div>
</div><!-- fragment --><h1>Forward filters</h1>
<p >A <code><a class="el" href="classnawa_1_1ForwardFilter.html">nawa::ForwardFilter</a></code> maps all requests with a matching URI to files on the file system and send these files to the user. The <code>basePath</code> is the directory where the files are located. With <code>basePathExtension</code>, you specify if the URI should be attached to the base path (<code>BY_PATH</code>, e.g., the request URI <code>/static/images/image.jpeg</code> would be mapped to <code>{basePath}/static/images/image.jpeg</code>), or only the filename (<code>BY_FILENAME</code>, default, e.g., the request URI <code>/static/images/image.jpeg</code> would be mapped to <code>{basePath}/image.jpeg</code>).</p>
<p >Example for a forward filter mapping to :</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classnawa_1_1ForwardFilter.html">nawa::ForwardFilter</a> imageFilter;</div>
<div class="line">imageFilter.<a class="code hl_function" href="classnawa_1_1AccessFilter.html#acfec1fb9ad929cee56d78fe058c3602e">pathFilter</a>({{<span class="stringliteral">&quot;static&quot;</span>, <span class="stringliteral">&quot;images&quot;</span>}});</div>
<div class="line">imageFilter.<a class="code hl_function" href="classnawa_1_1AccessFilter.html#a7027ed78938b1b563b7f3608a3858929">extensionFilter</a>({<span class="stringliteral">&quot;png&quot;</span>});</div>
<div class="line">imageFilter.<a class="code hl_function" href="classnawa_1_1ForwardFilter.html#ad561fb931a52fbac051c3e6793645b9b">basePath</a>(<span class="stringliteral">&quot;/var/www/multipage/images&quot;</span>);</div>
<div class="line">imageFilter.<a class="code hl_function" href="classnawa_1_1ForwardFilter.html#a624ac413c7befecf1e0722963d577411">basePathExtension</a>(<a class="code hl_enumvalue" href="classnawa_1_1ForwardFilter.html#a9fb4bb862f9b025eade4842a7423804aa94e197678f6ba57a36011daf6f13b3ea">nawa::ForwardFilter::BasePathExtension::BY_FILENAME</a>); <span class="comment">// could be skipped, default option anyway</span></div>
<div class="line">appInit.accessFilters().forwardFilters().push_back(imageFilter); <span class="comment">// add the filter to appInit</span></div>
<div class="ttc" id="aclassnawa_1_1ForwardFilter_html_a624ac413c7befecf1e0722963d577411"><div class="ttname"><a href="classnawa_1_1ForwardFilter.html#a624ac413c7befecf1e0722963d577411">nawa::ForwardFilter::basePathExtension</a></div><div class="ttdeci">BasePathExtension &amp; basePathExtension() noexcept</div></div>
<div class="ttc" id="aclassnawa_1_1ForwardFilter_html_a9fb4bb862f9b025eade4842a7423804aa94e197678f6ba57a36011daf6f13b3ea"><div class="ttname"><a href="classnawa_1_1ForwardFilter.html#a9fb4bb862f9b025eade4842a7423804aa94e197678f6ba57a36011daf6f13b3ea">nawa::ForwardFilter::BasePathExtension::BY_FILENAME</a></div><div class="ttdeci">@ BY_FILENAME</div></div>
<div class="ttc" id="aclassnawa_1_1ForwardFilter_html_ad561fb931a52fbac051c3e6793645b9b"><div class="ttname"><a href="classnawa_1_1ForwardFilter.html#ad561fb931a52fbac051c3e6793645b9b">nawa::ForwardFilter::basePath</a></div><div class="ttdeci">std::string &amp; basePath() noexcept</div></div>
</div><!-- fragment --><p >To become active, the filter has to be added to the corresponding vector in the <code><a class="el" href="classnawa_1_1AppInit.html">nawa::AppInit</a></code> object (see last line of the example).</p>
<h1>Block filters</h1>
<p >A <code><a class="el" href="classnawa_1_1BlockFilter.html">nawa::BlockFilter</a></code> responds to all requests with matching URIs with a standardized error page. This can be useful to respond with a "404 Not Found" to all URIs outside of the scope of your app, for example. The <code>status</code> attribute can be used to specify the HTTP status code that should be used (the message on the error page will be adapted to it).</p>
<p >Example for a simple BlockFilter that blocks every request outside of <code>/app</code> and <code>/static</code>:</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classnawa_1_1BlockFilter.html">nawa::BlockFilter</a> blockFilter;</div>
<div class="line">blockFilter.<a class="code hl_function" href="classnawa_1_1AccessFilter.html#acfec1fb9ad929cee56d78fe058c3602e">pathFilter</a>({{<span class="stringliteral">&quot;app&quot;</span>}, {<span class="stringliteral">&quot;static&quot;</span>}});</div>
<div class="line">blockFilter.<a class="code hl_function" href="classnawa_1_1AccessFilter.html#aa273a92f2164278fae73ca549a71ff7c">invert</a>(<span class="keyword">true</span>);</div>
<div class="line">blockFilter.<a class="code hl_function" href="classnawa_1_1BlockFilter.html#ad5270c81e329bccd6e4f5b4274e78780">status</a>(404);</div>
<div class="line">appInit.accessFilters().blockFilters().push_back(blockFilter);</div>
<div class="ttc" id="aclassnawa_1_1BlockFilter_html"><div class="ttname"><a href="classnawa_1_1BlockFilter.html">nawa::BlockFilter</a></div><div class="ttdef"><b>Definition:</b> <a href="BlockFilter_8h_source.html#l00033">BlockFilter.h:33</a></div></div>
<div class="ttc" id="aclassnawa_1_1BlockFilter_html_ad5270c81e329bccd6e4f5b4274e78780"><div class="ttname"><a href="classnawa_1_1BlockFilter.html#ad5270c81e329bccd6e4f5b4274e78780">nawa::BlockFilter::status</a></div><div class="ttdeci">unsigned int &amp; status() noexcept</div></div>
</div><!-- fragment --><h1>Auth filters</h1>
<p >A <code><a class="el" href="classnawa_1_1AuthFilter.html">nawa::AuthFilter</a></code> requests an HTTP basic authentication for every matching request. If the authentication is not successful, an error page (status code 403) will be sent.</p>
<p >The <code>authFunction</code> is a function that determines whether the auth was successful. The <code>authName</code> is the description of the auth that might be shown to the users by their web browser. If <code>useSessions</code> is true, NAWA will create a session variable containing the user name. See <code><a class="el" href="classnawa_1_1AuthFilter.html">nawa::AuthFilter</a></code> for details.</p>
<p >Example for an auth filter that authenticates everything under <code>/secret</code> and requires the user to provide the username "user" and the password "super_secret":</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classnawa_1_1AuthFilter.html">nawa::AuthFilter</a> authFilter;</div>
<div class="line">authFilter.<a class="code hl_function" href="classnawa_1_1AccessFilter.html#acfec1fb9ad929cee56d78fe058c3602e">pathFilter</a>({{<span class="stringliteral">&quot;secret&quot;</span>}});</div>
<div class="line">authFilter.<a class="code hl_function" href="classnawa_1_1AuthFilter.html#ae1db8fd065c3a1feb5d548ded9d68b8d">authName</a>(<span class="stringliteral">&quot;Top secret area!&quot;</span>);</div>
<div class="line">authFilter.<a class="code hl_function" href="classnawa_1_1AuthFilter.html#ae57a07a81bf42e60be79347b60fd0052">authFunction</a>() = [](std::string user, std::string password) -&gt; <span class="keywordtype">bool</span> {</div>
<div class="line">    <span class="keywordflow">return</span> (user == <span class="stringliteral">&quot;user&quot;</span> &amp;&amp; password == <span class="stringliteral">&quot;super_secret&quot;</span>);</div>
<div class="line">};</div>
<div class="line">appInit.accessFilters().authFilters().push_back(authFilter);</div>
<div class="ttc" id="aclassnawa_1_1AuthFilter_html"><div class="ttname"><a href="classnawa_1_1AuthFilter.html">nawa::AuthFilter</a></div><div class="ttdef"><b>Definition:</b> <a href="AuthFilter_8h_source.html#l00043">AuthFilter.h:43</a></div></div>
<div class="ttc" id="aclassnawa_1_1AuthFilter_html_ae1db8fd065c3a1feb5d548ded9d68b8d"><div class="ttname"><a href="classnawa_1_1AuthFilter.html#ae1db8fd065c3a1feb5d548ded9d68b8d">nawa::AuthFilter::authName</a></div><div class="ttdeci">std::string &amp; authName() noexcept</div></div>
<div class="ttc" id="aclassnawa_1_1AuthFilter_html_ae57a07a81bf42e60be79347b60fd0052"><div class="ttname"><a href="classnawa_1_1AuthFilter.html#ae57a07a81bf42e60be79347b60fd0052">nawa::AuthFilter::authFunction</a></div><div class="ttdeci">std::function&lt; bool(std::string, std::string)&gt; &amp; authFunction() noexcept</div></div>
</div><!-- fragment --><p >For a working example with static filters, see <code><a class="el" href="multipage_8cpp.html" title="A simple website consisting of multiple &#39;dynamic&#39; pages and virtual directories for html files and im...">examples/multipage.cpp</a></code>.</p>
<h1>Manually sending files</h1>
<p >To respond to a request with a file from disk manually, you can use the <code>connection.sendFile()</code> function, have a look at: <code><a class="el" href="classnawa_1_1Connection.html#aa6f3a6f0fb721766891cc673b2799705">nawa::Connection::sendFile()</a></code> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
