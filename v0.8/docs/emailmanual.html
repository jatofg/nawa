<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NAWA: Email</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NAWA
   &#160;<span id="projectnumber">0.8</span>
   </div>
   <div id="projectbrief">Web Application Framework for C++</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('emailmanual.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Email </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_docs_email"></a></p>
<p>NAWA allows you to easily send emails right from your app via SMTP.</p>
<h1>Creating and sending a simple email</h1>
<p>Create a <code>nawa::SimpleEmail</code> object:</p>
<div class="fragment"><div class="line">nawa::SimpleEmail email;</div>
</div><!-- fragment --><p>Create <code>nawa::EmailAddress</code> objects for the sender, recipient, and optionally the Reply-To address:</p>
<div class="fragment"><div class="line">EmailAddress from(connection.request.post[<span class="stringliteral">&quot;name&quot;</span>], <span class="stringliteral">&quot;contactform@example.com&quot;</span>);</div>
<div class="line">EmailAddress to(<span class="stringliteral">&quot;The Admin&quot;</span>, <span class="stringliteral">&quot;admin@example.com&quot;</span>);</div>
<div class="line">EmailAddress replyTo(connection.request.post[<span class="stringliteral">&quot;email&quot;</span>]);</div>
</div><!-- fragment --><p>Set the necessary headers (at least From, To, and Subject are generally considered to be necessary):</p>
<div class="fragment"><div class="line">email.headers()[<span class="stringliteral">&quot;From&quot;</span>] = from.get();</div>
<div class="line">email.headers()[<span class="stringliteral">&quot;To&quot;</span>] = to.get();</div>
<div class="line">email.headers()[<span class="stringliteral">&quot;Content-Type&quot;</span>] = <span class="stringliteral">&quot;text/plain; charset=UTF-8&quot;</span>;</div>
<div class="line">email.headers()[<span class="stringliteral">&quot;Subject&quot;</span>] = <a class="code" href="namespacenawa_1_1encoding.html#a823ddcf204da3022821813efe2b141c2">encoding::makeEncodedWord</a>(<span class="stringliteral">&quot;[Contact Form] &quot;</span> + post[<span class="stringliteral">&quot;subject&quot;</span>]);</div>
<div class="ttc" id="anamespacenawa_1_1encoding_html_a823ddcf204da3022821813efe2b141c2"><div class="ttname"><a href="namespacenawa_1_1encoding.html#a823ddcf204da3022821813efe2b141c2">nawa::encoding::makeEncodedWord</a></div><div class="ttdeci">std::string makeEncodedWord(std::string const &amp;input, bool base64=false, bool onlyIfNecessary=true)</div><div class="ttdef"><b>Definition:</b> <a href="encoding_8cpp_source.html#l00340">encoding.cpp:340</a></div></div>
</div><!-- fragment --><p>In the last line, so-called Q-encoding is applied to the subject, just in case it contains any illegal characters (as input from the user is used). You can use the following option to automatically encode the email, to make sure it doesn't contain any illegal characters which would violate the email standards:</p>
<div class="fragment"><div class="line">email.quotedPrintableEncode(<span class="keyword">true</span>);</div>
</div><!-- fragment --><p>And of course, don't forget to set the actual text/body of the email:</p>
<div class="fragment"><div class="line">email.text() = <span class="stringliteral">&quot;This is an example email!\r\n&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;Don&#39;t forget that according to the standard,\r\n&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;you have to use Windows-style CRLF line breaks!&quot;</span>;</div>
</div><!-- fragment --><p>Now, create a <code>nawa::SmtpMailer</code> object with the credentials of your SMTP server:</p>
<div class="fragment"><div class="line">SmtpMailer smtp(<span class="stringliteral">&quot;example.com&quot;</span>, 587, SmtpMailer::TlsMode::REQUIRE_STARTTLS,</div>
<div class="line">                 <span class="keyword">true</span>, <span class="stringliteral">&quot;test@example.com&quot;</span>, <span class="stringliteral">&quot;12345&quot;</span>);</div>
</div><!-- fragment --><p>Have a look at the <code>nawa::SmtpMailer</code> documentation for details. Add your email to the queue:</p>
<div class="fragment"><div class="line">smtp.enqueue(std::make_shared&lt;SimpleEmail&gt;(email), to, std::make_shared&lt;EmailAddress&gt;(from));</div>
</div><!-- fragment --><p>Use <code>std::make_shared</code> as this function requires the <code>nawa::Email</code> object and sender (From) address to be passed as shared pointers. You can optionally provide a list of replacement rules as an additional parameter to this function, which is useful for sending personalized messages to a large number of recipients without having to create an Email object for each of them. See <code>SmtpMailer::enqueue</code> for details.</p>
<p>For sending the same email to multiple recipients, you can also use the function <code>SmtpMailer::bulkEnqueue</code>.</p>
<p>And finally, send the email:</p>
<div class="fragment"><div class="line">smtp.processQueue();</div>
</div><!-- fragment --><p>You should, however, catch <code><a class="el" href="classnawa_1_1Exception.html">nawa::Exception</a></code> here, as this function establishes a connection to the SMTP server, which may fail. Errors may also occur during sending.</p>
<p>If you should need to send multiple emails, add all of them to the queue before calling <code>processQueue</code>, so that one SMTP connection is used for all of them.</p>
<p>Learning by example is the best way to learn, so have a look at <code><a class="el" href="contactform_8cpp.html" title="A simple contact form application using nawa.">examples/contactform.cpp</a></code> for a practical example. The documentation of the classes used in this example might contain additional features not mentioned in this tutorial, so make sure to read it as well :)</p>
<h1>MIME emails</h1>
<p>For sending complex emails with multiple MIME parts (such as text and HTML, or emails containing attachments), you can use the <code>nawa::MimeEmail</code> class:</p>
<div class="fragment"><div class="line">nawa::MimeEmail email2;</div>
<div class="line">email2.headers()[<span class="stringliteral">&quot;From&quot;</span>] = from.get();</div>
<div class="line">email2.headers()[<span class="stringliteral">&quot;To&quot;</span>] = to.get();</div>
<div class="line">email2.headers()[<span class="stringliteral">&quot;Subject&quot;</span>] = <span class="stringliteral">&quot;A MIME email&quot;</span>;</div>
</div><!-- fragment --><p>As you see, setting the headers works just like with simple emails. Concerning the content, however, they work differently: You'll have to create MIME parts using <code>nawa::MimeEmail::MimePart</code>. These parts have to be added to one or more <code>nawa::MimeEmail::MimePartList</code> objects. MIME part lists allow nesting, meaning that you can also add MIME part lists to a MIME part list.</p>
<p>The top-level MIME part list is the one in <code>nawa::MimeEmail::mimePartList</code>, i.e., already part of the <code>nawa::MimeEmail</code> object. Adding your MIME part lists and MIME parts there will add them to the email.</p>
<p>In the end, you can enqueue and send your MIME email just like a simple email.</p>
<p>As MIME parts and MIME part lists have a lot of options, make sure to read the example in <code>tests/emailtest.cpp</code> and the documentation of the classes mentioned in this tutorial. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
