<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NAWA: Getting Started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NAWA
   &#160;<span id="projectnumber">0.8</span>
   </div>
   <div id="projectbrief">Web Application Framework for C++</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('gettingstarted.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Getting Started </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_docs_gettingstarted"></a></p>
<p>This tutorial will explain how to write a simple, working "Hello World!" NAWA application.</p>
<p>A NAWA app consists of:</p><ul>
<li>A config file in INI format with options concerning the NAWA environment. Options to set up your own app can be added, too, you can access (and alter) the options within your app.</li>
<li>A shared object file containing the actual app.</li>
</ul>
<h1>The config file</h1>
<p>We will first have a look at the config file. You can find an example in the <code>config.ini</code> file in the top level of the repo.</p>
<p>The <code>[fastcgi]</code> section specifies how the app should communicate with the web server. In production environments, this should be done using the FastCGI protocol (however, NAWA can also open up a development web server, will be explained later). We recommend that you always use a UNIX socket, if possible. Set <code>mode</code> to <code>unix</code> and specify a path where the socket should be created in the <code>path</code> option. The socket will be created by NAWA, just make sure that:</p>
<ul>
<li>the path exists,</li>
<li>the user starting the app has both write and read permissions on the file (if the app is started by root and downgrades its permissions according to the relevant options in the <code>privileges</code> section, this doesn't matter, as the socket connection is established before the privilege downgrade happens), and</li>
<li>the web server has both read and write permissions on the socket file, too.</li>
</ul>
<p>In case this doesn't work for you, you can use a TCP socket. If the machine you're running the app on is connected to the Internet without an accordingly configured firewall, you should set the <code>listen</code> IP to <code>127.0.0.1</code>, so that only processes on the same machine can connect to the TCP socket. Use another interface on your own risk, there is no authentication whatsoever.</p>
<p>If you want to use the integrated development web server, you can configure it in the <code>[http]</code> section. We recommend that you only change the port, if desired, and leave the other settings as they are (the development web server should not be exposed to a public network or the internet). NAWA will then open a server on the port you've chosen (8080 by default), which can be accessed only from the local machine for safety reasons. If you want to make your app publicly available, please use the FastCGI request handler. Please also note that you have to change the <code>request_handler</code> setting in the <code>[system]</code> section to <code>http</code> in order to use the development web server instead of FastCGI.</p>
<p>In the next section, <code>[privileges]</code>, specify the system user and group your app should run at. NAWA will downgrade its privileges and continue running as the specified user and group after connecting to the socket. This will only work if the app is started as root. If you are not starting the app as root, make sure the starting user has all necessary permissions to create the socket.</p>
<p>In the <code>[system]</code> section, you can configure the request handler. If you want to use the integrated development web server instead of FastCGI (for testing purposes only), you can set <code>request_handler = http</code>. You can also specify the number of threads used for request handling. The default values, <code>concurrency = hardware</code> and <code>threads = 1.0</code>, will make NAWA determine the number of threads according to your hardware's parallelism capabilities. If this doesn't lead to the expected result on your system, you can use <code>concurrency = fixed</code> to specify a fixed number of threads.</p>
<p>The <code>[application]</code> section contains the path to the shared object file. Make sure the path points to your application file. We will see later how to create it.</p>
<p>The following sections, <code>[session]</code> and <code>[crypto]</code>, contain some options affecting the behavior of NAWA. The options are sufficiently explained in the config file itself, so we'll skip them for now.</p>
<h1>The application</h1>
<p>Now, we'll have a look on how to create a simple NAWA application. In the end, you'll have a shared object file (such as <code>libmyapp.so</code>) that you can refer to in the config file.</p>
<p>To create a NAWA app, you can use any IDE for C++, such as CLion. Start by creating a new shared library project (C++14 recommended).</p>
<p>For our simple example, you just need a single C++ file, which will probably be created automatically by your IDE.</p>
<p>For the start, you just need to include a single header file:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Application_8h.html">nawa/Application.h</a>&gt;</span></div>
<div class="ttc" id="aApplication_8h_html"><div class="ttname"><a href="Application_8h.html">Application.h</a></div><div class="ttdoc">This file will be configured by CMake and contains the necessary properties to ensure that a loaded a...</div></div>
</div><!-- fragment --><p>There are two required functions you need to implement in your app, <code>init</code> and <code>handleRequest</code>.</p>
<p>In the <code>init</code> function, you can alter the config (at least the options concerning your own app), set up static filters, and do any initialization you might want to do. If the return value is not 0, NAWA will terminate with an error, this can be useful, e.g., if the config file doesn't contain all necessary options needed by your app, or if your app encountered another problem during initialization.</p>
<p>The <code>init</code> function is run once before request handling starts, and request handling will not start until your <code>init</code> function has returned. So you should refrain from including long-running tasks. You can, however, start threads and processes that should run in the background.</p>
<p>However, if you initialize any data structures to use while handling requests, please be aware that the invocations of <code>handleRequest</code> might (and most probably will) run in multiple threads. Consider using thread-safe data structures :)</p>
<p>As we just want to create a simple, first example app, we'll ignore this function for now and just let this function return 0:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="Application_8h.html#ab862d0267d987adef3495419cd96a10b">init</a>(<a class="code" href="classnawa_1_1AppInit.html">nawa::AppInit</a> &amp;appInit) {</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aApplication_8h_html_ab862d0267d987adef3495419cd96a10b"><div class="ttname"><a href="Application_8h.html#ab862d0267d987adef3495419cd96a10b">init</a></div><div class="ttdeci">int init(nawa::AppInit &amp;appInit)</div><div class="ttdef"><b>Definition:</b> <a href="contactform_8cpp_source.html#l00040">contactform.cpp:40</a></div></div>
<div class="ttc" id="aclassnawa_1_1AppInit_html"><div class="ttname"><a href="classnawa_1_1AppInit.html">nawa::AppInit</a></div><div class="ttdef"><b>Definition:</b> <a href="AppInit_8h_source.html#l00032">AppInit.h:32</a></div></div>
</div><!-- fragment --><p>The <code>handleRequest</code> function is called once for each request (not always in the same thread, of course, if concurrency is used). The <code>Connection</code> structure contains essentially all properties of the request and can be used to specify the response. The return value is currently unused, but this may change. Consider returning 0 until then, which should be safe.</p>
<p>We'll deal later with the powerful <code>Connection</code> object, as for now, our goal is just to send a simple, but effective "Hello World!" to the browser. Let's go:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="Application_8h.html#ae1c02c6b05b0402ce3a00d450bd99252">handleRequest</a>(<a class="code" href="classnawa_1_1Connection.html">nawa::Connection</a> &amp;connection) {</div>
<div class="line">    connection.<a class="code" href="classnawa_1_1Connection.html#a65f495eea53b864f8e64473dbb3c66f9">responseStream</a>() &lt;&lt; <span class="stringliteral">&quot;Hello World!&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aApplication_8h_html_ae1c02c6b05b0402ce3a00d450bd99252"><div class="ttname"><a href="Application_8h.html#ae1c02c6b05b0402ce3a00d450bd99252">handleRequest</a></div><div class="ttdeci">int handleRequest(nawa::Connection &amp;connection)</div><div class="ttdef"><b>Definition:</b> <a href="contactform_8cpp_source.html#l00047">contactform.cpp:47</a></div></div>
<div class="ttc" id="aclassnawa_1_1Connection_html"><div class="ttname"><a href="classnawa_1_1Connection.html">nawa::Connection</a></div><div class="ttdef"><b>Definition:</b> <a href="Connection_8h_source.html#l00041">Connection.h:41</a></div></div>
<div class="ttc" id="aclassnawa_1_1Connection_html_a65f495eea53b864f8e64473dbb3c66f9"><div class="ttname"><a href="classnawa_1_1Connection.html#a65f495eea53b864f8e64473dbb3c66f9">nawa::Connection::responseStream</a></div><div class="ttdeci">std::ostream &amp; responseStream() noexcept</div><div class="ttdef"><b>Definition:</b> <a href="Connection_8cpp_source.html#l00364">Connection.cpp:364</a></div></div>
</div><!-- fragment --><p>And that's it! <code>connection.responseStream()</code> is an <code>ostream</code>, its contents will only be used after the response is flushed, either when the <code>handleRequest</code> function returns, or when you call <code>connection.flushResponse()</code> manually. Instead of using the stream, you could also do <code>connection.setResponseBody("Hello World!")</code>.</p>
<p>You can find the full source code of this example in the <code><a class="el" href="helloworld_8cpp.html" title="A very basic working example to get started.">examples/helloworld.cpp</a></code> file.</p>
<p>Now, compile your app (as a library) and insert the correct path into your <code>config.ini</code> file. If you're using CMake, you can do it like this (assuming that nawa, especially its headers, are installed on your system):</p>
<div class="fragment"><div class="line">add_library(myapp SHARED myapp.cpp)</div>
</div><!-- fragment --><p>Do not link your library against NAWA when writing apps this way. On macOS, you will have to use a special linker flag to avoid linking errors (neither necessary nor working on Linux):</p>
<div class="fragment"><div class="line">set_target_properties(myapp PROPERTIES LINK_FLAGS &quot;-undefined dynamic_lookup&quot;)</div>
</div><!-- fragment --><h1>Configuring the web server</h1>
<p>If you use the integrated development web server (HTTP request handler), you can skip this section, as NAWA will automatically start a web server for you.</p>
<p>If you're using FastCGI, you'll also have to configure your web server to connect to the FastCGI socket and make your new website accessible in your browser. How this works differs depending on the server you use. In Apache2, you'll have to enable the <code>proxy_fcgi</code> module by running</p>
<p><code>a2enmod proxy_fcgi</code></p>
<p>and add a line like this to your server configuration, using the correct path or URL of your socket (for a vhost or as a global directive, e.g., in a file <code>/etc/apache2/conf-enabled/nawa.conf</code>):</p>
<p><code>ProxyPass "/" "unix:/etc/nawa/sock.d/nawa.sock|fcgi://localhost/" enablereuse=on flushpackets=on</code></p>
<p>Or, in case of a TCP socket:</p>
<p><code>ProxyPass "/" "fcgi://127.0.0.1:8000/" enablereuse=on flushpackets=on</code></p>
<p>After restarting your web server (<code>systemctl restart apache2</code>), you should be all set for running and accessing your app!</p>
<h1>Run your app!</h1>
<p>In a terminal (assuming you're in the directory where the <code>config.ini</code> file is located), run:</p>
<p><code>nawarun</code></p>
<p>For more options (providing a path to the config file, command-line config overrides, no-config-file mode), run <code>nawarun -h</code> or <code>nawarun --help</code>.</p>
<p>Open your web browser and enjoy!</p>
<h2>Reloading the app</h2>
<p>You can send a SIGHUP signal to reload the config. Your app will be reloaded as well, allowing you to hot-swap it to a new version without stopping request handling. The new app's init function will run before request handling switches to the new app.</p>
<p>Please note that reloading only works if the config as well as the application file are still accessible after downgrading privileges. The configuration of the request handler (especially the <code>[fastcgi]</code>, <code>[http]</code>, and <code>[system]</code> sections of the config file) cannot be updated without restart.</p>
<h2>Using systemd</h2>
<p>The best way to keep a NAWA app running is to start it as a systemd service. That's easy, too, as NAWA already comes with the necessary systemd service file. If the path to your config file would be <code>/path/to/config.ini</code>, you would run (using systemd's escape format):</p>
<p><code>systemctl start nawa@-path-to-config.ini</code></p>
<p>To start your service automatically on boot:</p>
<p><code>systemctl enable nawa@-path-to-config.ini</code></p>
<p>To reload configuration and app (see above):</p>
<p><code>systemctl reload nawa@-path-to-config.ini</code></p>
<p>Of course, you can use <code>stop</code> to stop it, <code>restart</code> to restart it, and <code>disable</code> to stop automatically starting it on boot.</p>
<h1>Learn more</h1>
<p>Apart from reading the other tutorials, having a look at the examples is a good way to explore NAWA's features. <code><a class="el" href="multipage_8cpp.html" title="A simple website consisting of multiple &#39;dynamic&#39; pages and virtual directories for html files and im...">examples/multipage.cpp</a></code> is a good place to start. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
